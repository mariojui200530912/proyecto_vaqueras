@if (isLoading()) {
<div class="d-flex justify-content-center py-5">
  <div class="spinner-border text-primary"></div>
</div>
}
@else if (empresa(); as emp) {

<div class="bg-light border-bottom mb-4">
  <div class="container py-5">
    <div class="row align-items-center">

      <div class="col-md-3 text-center text-md-start mb-3 mb-md-0">
        <img [src]="emp.logo || 'assets/images/default-company.png'"
          class="rounded-circle shadow-sm border border-4 border-white"
          style="width: 150px; height: 150px; object-fit: cover;">
      </div>

      <div class="col-md-9 text-center text-md-start">
        <h1 class="display-5 fw-bold text-dark">{{ emp.nombre }}</h1>
        <p class="lead text-muted">{{ emp.descripcion }}</p>

        <div class="d-flex gap-2 justify-content-center justify-content-md-start mt-3">
          <span class="badge bg-secondary">
            <i class="bi bi-calendar"></i> Desde {{ emp.fechaCreacion | date:'yyyy' }}
          </span>
          <span class="badge bg-primary">
            <i class="bi bi-controller"></i> {{ juegos().length }} Juegos publicados
          </span>
        </div>

        @if (esPropietario) {
        <div class="mt-4 p-3 bg-white rounded shadow-sm border d-inline-block text-start">
          <h6 class="fw-bold text-primary mb-3"><i class="bi bi-gear-fill"></i> Panel de Gestión</h6>

          <div class="d-flex flex-wrap gap-2 align-items-center">
            <button class="btn btn-success btn-sm" (click)="irACrearJuego()">
              <i class="bi bi-plus-lg"></i> Nuevo Juego
            </button>

            <button class="btn btn-outline-secondary btn-sm" routerLink="/admin/empresas">
              <i class="bi bi-pencil"></i> Editar Perfil
            </button>

            <div class="vr mx-2"></div>

            <div class="form-check form-switch mb-0" title="Activa o desactiva comentarios en TODOS tus juegos">
              <input class="form-check-input cursor-pointer" type="checkbox" role="switch" id="globalComments"
                [checked]="emp.permiteComentarios" (change)="toggleComentariosGlobal()">
              <label class="form-check-label small fw-bold text-muted cursor-pointer" for="globalComments">
                Comentarios Globales
              </label>
            </div>
          </div>

          @if (!emp.permiteComentarios) {
          <div class="alert alert-warning py-1 px-2 mt-2 mb-0 small border-0">
            <i class="bi bi-exclamation-circle"></i> Tus juegos no recibirán comentarios mientras esto esté desactivado.
          </div>
          }
        </div>
        }
      </div>

    </div>
  </div>
</div>

<div class="container pb-5">
  <h3 class="fw-bold mb-4 border-start border-4 border-primary ps-3">Catálogo de Juegos</h3>

  <div class="row g-4">
    @for (juego of juegos(); track juego.id) {
    <div class="col-sm-6 col-lg-4 col-xl-3">

      <div class="card h-100 shadow-sm border-0 position-relative"
        [class.opacity-50]="juego.estadoVenta === 'SUSPENDIDO'">

        @if (esPropietario && juego.estadoVenta === 'SUSPENDIDO') {
        <span class="position-absolute top-0 end-0 badge bg-danger m-2 z-3">
          <i class="bi bi-pause-circle"></i> SUSPENDIDO
        </span>
        }

        <img [src]="juego.portada || 'assets/images/placeholder.jpg'" class="card-img-top"
          style="height: 200px; object-fit: cover; cursor: pointer;" [routerLink]="['/juego', juego.id]">

        <div class="card-body d-flex flex-column">
          <h5 class="card-title fw-bold text-truncate">{{ juego.titulo }}</h5>
          <div class="mb-3">
            <span class="badge bg-light text-dark border">{{ juego.clasificacion }}</span>
          </div>

          <div class="mt-auto d-flex justify-content-between align-items-center">
            <h5 class="text-success fw-bold mb-0">{{ juego.precio | currency:'GTQ' }}</h5>
            <a [routerLink]="['/juego', juego.id]" class="btn btn-sm btn-outline-primary">Ver</a>
          </div>
        </div>

        @if (esPropietario) {
        <div class="card-footer bg-white border-top-0 pt-0 pb-3">
          <hr>
          <div class="d-grid gap-2">
            <button class="btn btn-sm fw-bold" [class.btn-warning]="juego.estadoVenta === 'ACTIVO'"
              [class.btn-success]="juego.estadoVenta === 'SUSPENDIDO'" (click)="toggleEstado(juego)">
              @if (juego.estadoVenta === 'ACTIVO') {
              <i class="bi bi-pause-fill"></i> Suspender Venta
              } @else {
              <i class="bi bi-play-fill"></i> Activar Venta
              }
            </button>

            <button class="btn btn-sm btn-outline-dark" (click)="irAEditarJuego(juego.id)">
              <i class="bi bi-pencil-square"></i> Editar Datos
            </button>
          </div>
        </div>
        }

      </div>
    </div>
    } @empty {
    <div class="col-12 text-center py-5">
      <i class="bi bi-controller fs-1 text-muted opacity-25"></i>
      <p class="mt-3 text-muted">Esta empresa aún no ha publicado juegos.</p>
      @if (esPropietario) {
      <button class="btn btn-primary" (click)="irACrearJuego()">¡Publica el primero!</button>
      }
    </div>
    }
  </div>
</div>
}

<style>
  /* Estilo para cuando está suspendido */
  .opacity-50 {
    opacity: 0.6;
    filter: grayscale(100%);
    transition: 0.3s;
  }

  .opacity-50:hover {
    opacity: 1;
    filter: grayscale(0%);
    /* Al pasar el mouse, se ve color */
  }
</style>