<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="FeedbackEmpresa" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">
    <property name="com.jaspersoft.studio.data.defaultdataadapter" value="One Empty Record"/>

    <parameter name="ID_EMPRESA" class="java.lang.Integer"/>

    <queryString>
        <![CDATA[
		SELECT
			j.titulo,
			j.calificacion_promedio,
			u.nickname,
			c.texto,
			c.calificacion,
			c.fecha
		FROM comentario c
		INNER JOIN juego j ON c.id_juego = j.id
		INNER JOIN usuario u ON c.id_usuario = u.id
		WHERE j.id_empresa = $P{ID_EMPRESA}
		-- Ordenamos por Juego y luego por calificación (primero las malas para análisis)
		ORDER BY j.titulo ASC, c.calificacion ASC
		]]>
    </queryString>

    <field name="titulo" class="java.lang.String"/>
    <field name="calificacion_promedio" class="java.lang.Double"/>
    <field name="nickname" class="java.lang.String"/>
    <field name="texto" class="java.lang.String"/>
    <field name="calificacion" class="java.lang.Integer"/>
    <field name="fecha" class="java.sql.Timestamp"/>

    <group name="JuegoGroup">
        <groupExpression><![CDATA[$F{titulo}]]></groupExpression>
        <groupHeader>
            <band height="45">
                <textField>
                    <reportElement x="0" y="10" width="300" height="30" forecolor="#2C3E50"/>
                    <textElement verticalAlignment="Middle"><font size="14" isBold="true"/></textElement>
                    <textFieldExpression><![CDATA[$F{titulo}]]></textFieldExpression>
                </textField>
                <textField>
                    <reportElement x="300" y="10" width="255" height="30" forecolor="#7F8C8D"/>
                    <textElement textAlignment="Right" verticalAlignment="Middle"><font size="12"/></textElement>
                    <textFieldExpression><![CDATA["Promedio Global: " + $F{calificacion_promedio} + " / 5.0"]]></textFieldExpression>
                </textField>
                <line>
                    <reportElement x="0" y="40" width="555" height="1"/>
                </line>
            </band>
        </groupHeader>
    </group>

    <title>
        <band height="50">
            <staticText>
                <reportElement x="0" y="10" width="555" height="30"/>
                <textElement textAlignment="Center"><font size="18" isBold="true"/></textElement>
                <text><![CDATA[Reporte de Calidad y Feedback]]></text>
            </staticText>
        </band>
    </title>

    <detail>
        <band height="50">
            <textField>
                <reportElement x="0" y="0" width="40" height="20"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{calificacion} + "★"]]></textFieldExpression>
            </textField>

            <textField>
                <reportElement x="50" y="0" width="200" height="20" forecolor="#666666"/>
                <textElement verticalAlignment="Middle"><font size="9" isItalic="true"/></textElement>
                <textFieldExpression><![CDATA[$F{nickname} + " - " + $F{fecha}]]></textFieldExpression>
            </textField>

            <textField textAdjust="StretchHeight">
                <reportElement x="50" y="20" width="500" height="20"/>
                <textElement verticalAlignment="Top"/>
                <textFieldExpression><![CDATA[$F{texto}]]></textFieldExpression>
            </textField>
        </band>
    </detail>
</jasperReport>